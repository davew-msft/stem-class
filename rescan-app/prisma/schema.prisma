// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String    @id @default(uuid())
  session_id        String    @unique
  street_address    String?
  geocoded_location String?   // Will store PostGIS point as string for now
  total_points      Int       @default(0)
  created_at        DateTime  @default(now())
  updated_at        DateTime  @updatedAt
  last_scan_at      DateTime?
  
  scans             Scan[]
  
  @@map("users")
}

model RicCode {
  code                   Int      @id
  plastic_type          String
  description           String
  general_recyclability String   // recyclable, not_recyclable, conditional
  common_products       String[] // Array of common product types
  recycling_notes       String
  
  scans                 Scan[]
  
  @@map("ric_codes")
}

model Scan {
  id                     String   @id @default(uuid())
  user_id               String
  ric_code              Int
  is_recyclable_locally Boolean
  points_awarded        Int
  scan_method           String   // camera, manual_entry
  location_used         String?  // PostGIS point as string
  created_at            DateTime @default(now())
  
  user                  User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  ric_code_ref          RicCode  @relation(fields: [ric_code], references: [code])
  
  @@map("scans")
}

model RecyclingCapability {
  id                String   @id @default(uuid())
  facility_name     String
  service_area      String   // PostGIS polygon as string
  accepted_ric_codes Int[]   // Array of accepted RIC codes
  facility_type     String   // curbside, drop_off, special_collection
  address           String
  contact_info      String?
  notes             String?
  last_updated      DateTime @default(now())
  
  @@map("recycling_capabilities")
}